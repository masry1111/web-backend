<!DOCTYPE html>
<html>
<head>
    <title>My Bookings</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<header>
    <h2>My Bookings</h2>
</header>

<div id="bookingList" class="room-list"></div>

<script>
function loadBookings() {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", "http://localhost:5000/api/my-bookings", true);
    xhr.withCredentials = true;

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            var data = null;
            try { data = JSON.parse(xhr.responseText); } catch (e) {}

            var container = document.getElementById("bookingList");
            container.innerHTML = "";

            if (xhr.status !== 200 || !data || data.length === 0) {
                container.innerHTML = "<p>You have no bookings yet.</p>";
                return;
            }

            for (var i = 0; i < data.length; i++) {
                var b = data[i];

                var card = document.createElement("div");
                card.className = "room-card";

                card.innerHTML =
                    "<h3>" + b.roomType + "</h3>" +
                    "<p>Check-in: " + b.checkInDate + "</p>" +
                    "<p>Check-out: " + b.checkOutDate + "</p>" +
                    "<p>Status: " + b.status + "</p>" +
                    "<button class='cancelBtn' onclick='cancelBooking(" + b.id + ")'>Cancel Booking</button>";

                container.appendChild(card);
            }
        }
    };

    xhr.send();
}

function cancelBooking(id) {
    if (!id) {
        alert("Invalid booking ID.");
        return;
    }

    var xhr = new XMLHttpRequest();
    xhr.open("PUT", "http://localhost:5000/api/cancel/" + id, true);
    xhr.withCredentials = true;

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            if (xhr.status === 200) {
                alert("Booking canceled successfully.");
                loadBookings();
            } else {
                alert("Failed to cancel booking.");
            }
        }
    };

    xhr.send();
}

loadBookings();
</script>

</body>
</html>
